<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core 4 Master Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        .glow {
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }
        .core-active {
            border-color: #06b6d4;
            background: rgba(6, 182, 212, 0.1);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.4);
        }
        .metric-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.5);
        }
        .health-good { color: #10b981; }
        .health-warning { color: #f59e0b; }
        .health-critical { color: #ef4444; }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="text-slate-200">
    <div id="dashboard" class="p-6 max-w-7xl mx-auto">
        <!-- Connection Status -->
        <div id="connection-status" class="mb-6 p-4 rounded-lg bg-slate-800/50 border border-slate-700">
            <div class="flex items-center gap-3">
                <div id="status-indicator" class="w-3 h-3 rounded-full bg-red-500 pulse"></div>
                <span id="status-text" class="text-sm">Connecting to Core 4 Nexus...</span>
            </div>
        </div>

        <!-- Header -->
        <div class="flex justify-between items-center mb-8 pb-4 border-b border-slate-800">
            <h1 class="text-2xl font-bold text-cyan-400 tracking-wider">CORE 4 // MASTER COMMAND</h1>
            <div class="flex gap-6 text-sm">
                <span>SYSTEM HEALTH: <span id="system-health" class="font-bold">--</span></span>
                <span>AUDIO LATENCY: <span id="audio-latency" class="font-bold">--</span></span>
                <span>VAULT LOAD: <span id="vault-load" class="font-bold">--</span></span>
            </div>
        </div>

        <!-- Core Intelligence Grid -->
        <div class="mb-8">
            <h2 class="text-lg font-semibold text-slate-300 mb-4">Core Intelligence Matrix</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="cores-grid">
                <!-- Cores will be populated here -->
            </div>
        </div>

        <!-- Attention & Phase Coherence -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="metric-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-purple-400 mb-4">Attention Governor</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span>Active Core:</span>
                        <span id="active-core" class="font-bold text-cyan-400">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Meta Confidence:</span>
                        <span id="meta-confidence" class="font-bold">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Phase Coherence:</span>
                        <span id="phase-coherence" class="font-bold">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Decision Latency:</span>
                        <span id="decision-latency" class="font-bold">--</span>
                    </div>
                </div>
            </div>

            <div class="metric-card p-6 rounded-lg">
                <h3 class="text-lg font-semibold text-green-400 mb-4">System Performance</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span>CPU Load:</span>
                        <span id="cpu-load" class="font-bold">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Vault Entries:</span>
                        <span id="vault-entries" class="font-bold">--</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Vault Integrity:</span>
                        <span id="vault-integrity" class="font-bold">--</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Infrastructure Modules -->
        <div class="mb-8">
            <h2 class="text-lg font-semibold text-slate-300 mb-4">Infrastructure Modules</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="metric-card p-4 rounded-lg">
                    <h4 class="text-cyan-500 font-semibold mb-2">DALS</h4>
                    <div class="space-y-1 text-sm">
                        <div>Status: <span id="dals-status" class="font-bold">--</span></div>
                        <div>Throughput: <span id="dals-throughput" class="font-bold">--</span> req/s</div>
                        <div>Latency: <span id="dals-latency" class="font-bold">--</span>ms</div>
                        <div>Active Tasks: <span id="dals-tasks" class="font-bold">--</span></div>
                    </div>
                </div>

                <div class="metric-card p-4 rounded-lg">
                    <h4 class="text-purple-500 font-semibold mb-2">GOAT</h4>
                    <div class="space-y-1 text-sm">
                        <div>Status: <span id="goat-status" class="font-bold">--</span></div>
                        <div>Accuracy: <span id="goat-accuracy" class="font-bold">--</span></div>
                        <div>Predictions: <span id="goat-predictions" class="font-bold">--</span></div>
                        <div>Confidence: <span id="goat-confidence" class="font-bold">--</span></div>
                    </div>
                </div>

                <div class="metric-card p-4 rounded-lg">
                    <h4 class="text-yellow-500 font-semibold mb-2">TrueMark</h4>
                    <div class="space-y-1 text-sm">
                        <div>Status: <span id="truemark-status" class="font-bold">--</span></div>
                        <div>Minted: <span id="truemark-minted" class="font-bold">--</span></div>
                        <div>Pending: <span id="truemark-pending" class="font-bold">--</span></div>
                        <div>Verified: <span id="truemark-verified" class="font-bold">--</span></div>
                    </div>
                </div>

                <div class="metric-card p-4 rounded-lg">
                    <h4 class="text-green-500 font-semibold mb-2">CertSig</h4>
                    <div class="space-y-1 text-sm">
                        <div>Status: <span id="certsig-status" class="font-bold">--</span></div>
                        <div>Signatures: <span id="certsig-signatures" class="font-bold">--</span></div>
                        <div>Certificates: <span id="certsig-certificates" class="font-bold">--</span></div>
                        <div>Validity: <span id="certsig-validity" class="font-bold">--</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attention Matrix -->
        <div class="metric-card p-6 rounded-lg">
            <h3 class="text-lg font-semibold text-orange-400 mb-4">Attention Matrix</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-slate-700">
                            <th class="text-left p-2">Source â†’ Target</th>
                            <th class="text-center p-2">UCM Core</th>
                            <th class="text-center p-2">KayGee</th>
                            <th class="text-center p-2">Caleon</th>
                            <th class="text-center p-2">Cali X</th>
                        </tr>
                    </thead>
                    <tbody id="attention-matrix">
                        <!-- Matrix will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let ws;
        let telemetry = null;

        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8001/ws/master');

            ws.onopen = function(event) {
                document.getElementById('status-indicator').className = 'w-3 h-3 rounded-full bg-green-500';
                document.getElementById('status-text').textContent = 'Connected to Core 4 Nexus';
                console.log('Connected to Core 4 Master Dashboard');
            };

            ws.onmessage = function(event) {
                try {
                    telemetry = JSON.parse(event.data);
                    updateDashboard(telemetry);
                } catch (error) {
                    console.error('Error parsing WebSocket data:', error);
                }
            };

            ws.onclose = function(event) {
                document.getElementById('status-indicator').className = 'w-3 h-3 rounded-full bg-red-500 pulse';
                document.getElementById('status-text').textContent = 'Disconnected - Reconnecting...';
                console.log('Disconnected, reconnecting...');
                setTimeout(connectWebSocket, 3000);
            };

            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
            };
        }

        function updateDashboard(data) {
            // Update header metrics
            const health = data.system?.health || 0;
            const healthElement = document.getElementById('system-health');
            healthElement.textContent = (health * 100).toFixed(1) + '%';
            healthElement.className = health > 0.8 ? 'font-bold health-good' :
                                    health > 0.6 ? 'font-bold health-warning' : 'font-bold health-critical';

            document.getElementById('audio-latency').textContent = (data.audio?.latency || 0).toFixed(2) + 'ms';
            document.getElementById('vault-load').textContent = ((data.system?.vault_load || 0) * 100).toFixed(1) + '%';

            // Update cores grid
            const coresGrid = document.getElementById('cores-grid');
            coresGrid.innerHTML = '';

            Object.entries(data.cores || {}).forEach(([name, core]) => {
                const isActive = data.attention?.active_core === name;
                const coreCard = document.createElement('div');
                coreCard.className = `metric-card p-4 rounded-lg ${isActive ? 'core-active glow' : ''}`;

                coreCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="uppercase text-xs text-slate-500">${name.replace('_', ' ')}</h3>
                        ${isActive ? '<div class="w-2 h-2 bg-cyan-400 rounded-full"></div>' : ''}
                    </div>
                    <div class="text-2xl font-bold mb-1">${(core.confidence * 100).toFixed(1)}%</div>
                    <div class="text-xs text-slate-400 mb-2">Weight: ${(core.attention_weight * 100).toFixed(1)}%</div>
                    <div class="text-[10px] italic text-slate-500 line-clamp-2">"${core.verdict}"</div>
                    <div class="text-xs text-slate-600 mt-2">Latency: ${core.latency.toFixed(2)}ms</div>
                `;

                coresGrid.appendChild(coreCard);
            });

            // Update attention governor
            document.getElementById('active-core').textContent = data.attention?.active_core?.replace('_', ' ') || '--';
            document.getElementById('meta-confidence').textContent = data.attention?.meta_confidence ? (data.attention.meta_confidence * 100).toFixed(1) + '%' : '--';
            document.getElementById('phase-coherence').textContent = data.attention?.phase_coherence ? (data.attention.phase_coherence * 100).toFixed(1) + '%' : '--';
            document.getElementById('decision-latency').textContent = data.attention?.decision_latency ? data.attention.decision_latency.toFixed(2) + 'ms' : '--';

            // Update system performance
            document.getElementById('cpu-load').textContent = data.system?.cpu_load ? (data.system.cpu_load * 100).toFixed(1) + '%' : '--';
            document.getElementById('vault-entries').textContent = data.vault?.entries || '--';
            document.getElementById('vault-integrity').textContent = data.vault?.integrity ? (data.vault.integrity * 100).toFixed(1) + '%' : '--';

            // Update infrastructure modules
            document.getElementById('dals-status').textContent = data.dals?.status || '--';
            document.getElementById('dals-throughput').textContent = data.dals?.throughput || '--';
            document.getElementById('dals-latency').textContent = data.dals?.latency || '--';
            document.getElementById('dals-tasks').textContent = data.dals?.active_tasks || '--';

            document.getElementById('goat-status').textContent = data.goat?.status || '--';
            document.getElementById('goat-accuracy').textContent = data.goat?.accuracy ? (data.goat.accuracy * 100).toFixed(1) + '%' : '--';
            document.getElementById('goat-predictions').textContent = data.goat?.predictions || '--';
            document.getElementById('goat-confidence').textContent = data.goat?.confidence ? (data.goat.confidence * 100).toFixed(1) + '%' : '--';

            document.getElementById('truemark-status').textContent = data.truemark?.status || '--';
            document.getElementById('truemark-minted').textContent = data.truemark?.minted || '--';
            document.getElementById('truemark-pending').textContent = data.truemark?.pending || '--';
            document.getElementById('truemark-verified').textContent = data.truemark?.verified || '--';

            document.getElementById('certsig-status').textContent = data.certsig?.status || '--';
            document.getElementById('certsig-signatures').textContent = data.certsig?.signatures || '--';
            document.getElementById('certsig-certificates').textContent = data.certsig?.certificates || '--';
            document.getElementById('certsig-validity').textContent = data.certsig?.validity ? (data.certsig.validity * 100).toFixed(1) + '%' : '--';

            // Update attention matrix
            const matrixBody = document.getElementById('attention-matrix');
            matrixBody.innerHTML = '';

            if (data.attention?.weights) {
                Object.entries(data.attention.weights).forEach(([source, targets]) => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-slate-800';

                    row.innerHTML = `
                        <td class="p-2 font-medium">${source.replace('_', ' ')}</td>
                        <td class="text-center p-2">${(targets.ucm_core * 100).toFixed(1)}%</td>
                        <td class="text-center p-2">${(targets.kaygee * 100).toFixed(1)}%</td>
                        <td class="text-center p-2">${(targets.caleon * 100).toFixed(1)}%</td>
                        <td class="text-center p-2">${(targets.cali_x * 100).toFixed(1)}%</td>
                    `;

                    matrixBody.appendChild(row);
                });
            }
        }

        // Initialize connection
        connectWebSocket();

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (ws) {
                ws.close();
            }
        });
    </script>
</body>
</html>